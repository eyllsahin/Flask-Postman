{% extends "base.html" %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/magical-common.css') }}">
<style>
/* Enhanced Magical Forest Admin Theme */
.admin-container {
    padding: 2rem;
    max-width: 1400px;
    margin: 0 auto;
    position: relative;
    z-index: 1;
}

.admin-container::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle at center, rgba(192, 216, 192, 0.05) 0%, rgba(44, 85, 48, 0.1) 100%);
    border-radius: 20px;
    z-index: -1;
}

.admin-title {
    font-family: 'Cinzel', serif;
    color: var(--text-light);
    text-align: center;
    margin-bottom: 2rem;
    text-shadow: 0 0 15px rgba(192, 216, 192, 0.5);
    font-size: 2.2rem;
    position: relative;
    display: inline-block;
    width: 100%;
}

.admin-title::before,
.admin-title::after {
    content: '✧';
    display: inline-block;
    margin: 0 15px;
    color: var(--highlight);
    opacity: 0.8;
}

.stats-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 2rem;
    margin-bottom: 3rem;
}

.stat-card {
    background: rgba(255, 255, 255, 0.07);
    backdrop-filter: blur(10px);
    padding: 2rem;
    border-radius: 15px;
    border: 1px solid rgba(192, 216, 192, 0.2);
    text-align: center;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.stat-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, rgba(192, 216, 192, 0.05) 0%, rgba(44, 85, 48, 0.05) 100%);
    z-index: -1;
}

.stat-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(192, 216, 192, 0.15);
}

.stat-card h3 {
    font-family: 'Cinzel', serif;
    margin-bottom: 1rem;
    color: var(--highlight);
    font-size: 1.3rem;
}

.stat-number {
    font-size: 2.2rem;
    font-family: 'Cinzel', serif;
    font-weight: 600;
    color: var(--text-light);
    text-shadow: 0 0 10px rgba(192, 216, 192, 0.5);
    margin: 0;
}

.data-section {
    background: rgba(255, 255, 255, 0.07);
    backdrop-filter: blur(10px);
    padding: 2rem;
    border-radius: 15px;
    border: 1px solid rgba(192, 216, 192, 0.2);
}

.data-section h2 {
    font-family: 'Cinzel', serif;
    color: var(--highlight);
    margin-bottom: 1.5rem;
    text-align: center;
    position: relative;
}

.data-section h2::after {
    content: '';
    position: absolute;
    bottom: -8px;
    left: 50%;
    transform: translateX(-50%);
    width: 120px;
    height: 2px;
    background: linear-gradient(90deg, transparent, var(--highlight), transparent);
}

.table-container {
    overflow-x: auto;
    margin-top: 1.5rem;
}

.admin-table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    table-layout: fixed; /* Fixed table layout */
}

.admin-table th {
    font-family: 'Cinzel', serif;
    color: var(--highlight);
    font-weight: normal;
    padding: 1.2rem 1rem;
    text-align: left;
    border-bottom: 2px solid rgba(192, 216, 192, 0.2);
}

.admin-table td {
    padding: 1.2rem 1rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.08);
    word-wrap: break-word;
    overflow-wrap: break-word;
}

/* Column widths for admin table */
.admin-table th:nth-child(1), .admin-table td:nth-child(1) { width: 8%; } /* User ID */
.admin-table th:nth-child(2), .admin-table td:nth-child(2) { width: 15%; } /* Username */
.admin-table th:nth-child(3), .admin-table td:nth-child(3) { width: 20%; } /* Email */
.admin-table th:nth-child(4), .admin-table td:nth-child(4) { width: 10%; } /* Session ID */
.admin-table th:nth-child(5), .admin-table td:nth-child(5) { width: 25%; max-width: 200px; } /* Title */
.admin-table th:nth-child(6), .admin-table td:nth-child(6) { width: 12%; } /* Created */
.admin-table th:nth-child(7), .admin-table td:nth-child(7) { width: 10%; } /* Status */

.session-title {
    max-width: 200px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    display: inline-block;
}

.session-title:hover {
    white-space: normal;
    word-wrap: break-word;
    overflow-wrap: break-word;
    max-width: none;
}

.admin-table tr {
    transition: all 0.3s ease;
}

.admin-table tr:hover {
    background: rgba(255, 255, 255, 0.05);
}

.status-badge {
    padding: 0.3rem 0.8rem;
    border-radius: 20px;
    font-size: 0.9rem;
    display: inline-block;
}

.status-badge.active {
    background: rgba(144, 238, 144, 0.15);
    color: #90EE90;
    border: 1px solid rgba(144, 238, 144, 0.3);
}

.status-badge.inactive {
    background: rgba(255, 99, 71, 0.15);
    color: #FF6347;
    border: 1px solid rgba(255, 99, 71, 0.3);
}

.no-sessions {
    text-align: center;
    color: rgba(255, 255, 255, 0.6);
    font-style: italic;
}

.admin-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    position: relative;
}

.magical-btn {
    background: var(--accent-color);
    color: var(--text-light);
    border: none;
    padding: 0.8rem 1.5rem;
    border-radius: 12px;
    cursor: pointer;
    font-family: 'Cinzel', serif;
    font-size: 1rem;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.magical-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(139, 69, 19, 0.3);
}

.magical-btn::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(255, 255, 255, 0.3) 0%, transparent 60%);
    transform: rotate(45deg);
    transition: all 0.5s ease;
    opacity: 0;
}

.magical-btn:hover::before {
    opacity: 0.5;
    animation: shine 1.5s infinite linear;
}

@keyframes shine {
    0% {
        transform: rotate(45deg) translateX(-100%);
    }
    100% {
        transform: rotate(45deg) translateX(100%);
    }
}

/* Add fairy lights */
.fairy {
    position: fixed;
    width: 6px;
    height: 6px;
    background: #FFE5B4;
    border-radius: 50%;
    filter: blur(1px);
    box-shadow: 0 0 10px #FFE5B4, 0 0 20px #FFE5B4, 0 0 30px #FFE5B4, 0 0 40px #FFB6C1;
    animation: float 15s infinite ease-in-out;
    opacity: 0;
    z-index: 1000;
}

@keyframes float {
    0%, 100% {
        transform: translate(0, 0) scale(1);
        opacity: 0;
    }
    25% {
        transform: translate(20px, -20px) scale(1.2);
        opacity: 0.9;
    }
    50% {
        transform: translate(40px, 0) scale(1);
        opacity: 0.6;
    }
    75% {
        transform: translate(20px, 20px) scale(1.2);
        opacity: 0.9;
    }
}
</style>
{% endblock %}

{% block content %}
<!-- Add fairy lights -->
<div class="fairy" style="top: 10%; left: 5%;"></div>
<div class="fairy" style="top: 30%; left: 15%;"></div>
<div class="fairy" style="top: 60%; left: 8%;"></div>
<div class="fairy" style="top: 20%; left: 90%;"></div>
<div class="fairy" style="top: 80%; left: 85%;"></div>
<div class="fairy" style="top: 50%; left: 95%;"></div>

<div class="admin-container">
    <div class="admin-header">
        <h1 class="admin-title">✧ Magical Forest Administration ✧</h1>
        <button id="logoutBtn" class="magical-btn">Leave Realm</button>
    </div>
    
    <div class="stats-container">
        <div class="stat-card">
            <h3>Total Users</h3>
            <p class="stat-number">{{ stats.total_users }}</p>
        </div>
        <div class="stat-card">
            <h3>Active Sessions</h3>
            <p class="stat-number">{{ stats.active_sessions }}</p>
        </div>
        <div class="stat-card">
            <h3>Total Messages</h3>
            <p class="stat-number">{{ stats.total_messages }}</p>
        </div>
    </div>

    <div class="data-section">
        <h2>Users & Sessions</h2>
        <div class="table-container">
            <table class="admin-table">
                <thead>
                    <tr>
                        <th>User ID</th>
                        <th>Username</th>
                        <th>Email</th>
                        <th>Session ID</th>
                        <th>Session Title</th>
                        <th>Created At</th>
                        <th>Status</th>
                        <th>Messages</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user in users %}
                        {% if user.sessions %}
                            {% for session in user.sessions %}
                                <tr>
                                    <td>{{ user.id }}</td>
                                    <td>{{ user.username }}</td>
                                    <td>{{ user.email }}</td>
                                    <td>{{ session.id }}</td>
                                    <td class="session-title">{{ session.title | e | truncate(40, true, '...') }}</td>
                                    <td>{{ session.created_at }}</td>
                                    <td>
                                        <span class="status-badge {% if session.is_active %}active{% else %}inactive{% endif %}">
                                            {{ 'Active' if session.is_active else 'Inactive' }}
                                        </span>
                                    </td>
                                    <td>{{ session.message_count }}</td>
                                </tr>
                            {% endfor %}
                        {% else %}
                            <tr>
                                <td>{{ user.id }}</td>
                                <td>{{ user.username }}</td>
                                <td>{{ user.email }}</td>
                                <td colspan="5" class="no-sessions">No sessions</td>
                            </tr>
                        {% endif %}
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/admin.js') }}"></script>
<script>
document.addEventListener('DOMContentLoaded', () => {
    // Add animated fairy lights
    function createFairies(count) {
        const container = document.body;
        for (let i = 0; i < count; i++) {
            const fairy = document.createElement('div');
            fairy.className = 'fairy';
            fairy.style.top = Math.random() * 100 + '%';
            fairy.style.left = Math.random() * 100 + '%';
            fairy.style.animationDuration = 10 + Math.random() * 20 + 's';
            fairy.style.animationDelay = Math.random() * 5 + 's';
            container.appendChild(fairy);
        }
    }
    
    // Create additional fairies
    createFairies(10);
    
    // Add shimmer effect to stat cards
    const statCards = document.querySelectorAll('.stat-card');
    statCards.forEach(card => {
        card.addEventListener('mouseenter', () => {
            card.style.boxShadow = '0 0 20px rgba(192, 216, 192, 0.3)';
        });
        card.addEventListener('mouseleave', () => {
            card.style.boxShadow = '';
        });
    });
    
    // Add logout functionality
    const logoutBtn = document.getElementById('logoutBtn');
    if (logoutBtn) {
        logoutBtn.addEventListener('click', () => {
            localStorage.removeItem('token');
            window.location.href = '/login';
        });
    }
});
</script>
{% endblock %}
